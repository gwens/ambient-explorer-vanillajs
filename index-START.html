<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="email-browser">
    <div class="navigation">
      <form class="search-form">
        <input type="text" class="search" placeholder="City or State">
        <ul class="suggestions">
          <li>Filter for a city</li>
          <li>or a state</li>
        </ul>
      </form>
    </div>
    <div class="reader">test
    </div>
  </div>
<script type="text/javascript" src="amb-1000.js"></script>
<script>

const emails = [];

emails.push(...data);

function findMatches(wordToMatch, emails) {
  return emails.filter(email => {
    // figure out if the email subject contains the search string
    // create new regex. pass in the thing to match and the flags you want
    const regex = new RegExp(wordToMatch, 'gi'); // g = global (search the whole string); i = case insensitive
    return email.subject && email.subject.match(regex) // some subjects are blank/null
  });
}

function displayEmail(e) {
  console.log(this.id);
  const emailSelected = emails.find(email => email.id === this.id);
  emailReader.innerHTML = `${emailSelected.content}`;
}

function displayMatches() {
  const results = findMatches(this.value, emails); // this.value returns the text string! Good to know! not easy to see if you just console.log(this)
  const html = results.map(email => {
    const regex = new RegExp(this.value, 'gi');
    const  subjectHtml = email.subject.replace(regex, `<span class="hl">${this.value}</span>`);
    return `
      <li class="email-mini" id=${email.id}>
        <span class="subject">${subjectHtml}</span>
      </li>
    `;
  }).join(''); // map would return an array, so we join it to get one big string

  suggestions.innerHTML = html;
  const emailMinis = document.querySelectorAll('.email-mini');
  // Once the suggestions are displayed, add event listeners so we can click on them and display the relevant email
  emailMinis.forEach(emailMini => emailMini.addEventListener('click', displayEmail));
}

const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');
const emailReader = document.querySelector('.reader');

searchInput.addEventListener('change', displayMatches);
searchInput.addEventListener('keyup', displayMatches);

</script>
  </body>
</html>
